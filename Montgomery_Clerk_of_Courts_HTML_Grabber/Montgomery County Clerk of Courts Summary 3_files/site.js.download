function initializeSession() {
    var formData;
    if (getParameterByName("SID") != null)
        formData = "SID=" + getParameterByName("SID");
    jQuery.ajax({
        data: formData,
        url: "Helpers/initializeSession.aspx",
        type: "GET",
        datatype: 'html',
        cache: false,
        error: function () {
            alert("InitializeSession: A problem has occurred. Please contact the Clerk's Office @ 937-496-7623");
        },
        success: function (r) {
            var myValues = r.split("|")
            //var myModal = bootstrap.Modal.getInstance(document.getElementById('DisclaimerModal'));
            //if(myModal) // THIS CHECKS TO SEE IF MY MODAL EXISTS OR NOT. IF IT DOESN'T EXIST, THEN THE .HIDE() STATEMENT WON'T WORK
            //    myModal.hide();
            $("#userDomain").html("Welcome " + myValues[0]);
            if (disclaimer != "true") {
                disclaimer = myValues[1];
                if (disclaimer == "False") {
                    openDisclaimer();
                }
            }
            //if (myValues[2] == "0") {
            //    $("#ddAdmin").remove();
            //}
            buildSearchCriteria();
        }
    });
}

function authenticateLogin() {
    var restoreSession = false;
    jQuery.ajax({
        data: "UserIdentifier=" + $("#Username").val() + "&Password=" + $("#Password").val(),
        url: "Helpers/authenticateUser.aspx",
        type: "POST",
        datatype: 'html',
        cache: false,
        error: function () {
            alert("AuthenticateLogin: A problem has occurred. Please contact the Clerk's Office @ 937-496-7623");
        },
        success: function (r) {
            if (r == 0) {
                $("#LoginAlert").addClass("alert-warning");
                $("#LoginText").html("Username/Password are unable to authenticate.")
                $("#LoginAlert").css("display", "");
                return;
            } else if (r == 2) {
                $("#LoginAlert").addClass("alert-warning");
                $("#LoginText").html("Username cannot be found.")
                $("#LoginAlert").css("display", "");
                return;
            } else if (r == 4) {
                $("#LoginAlert").addClass("alert-warning");
                $("#LoginText").html("Username is disabled.")
                $("#LoginAlert").css("display", "");
                return;
            } else if (r == 3) {
                restoreSession = confirm("Previous Session was found. Would you like to restore it?");
            }
            userLogin(restoreSession);
        }
    });
}

function userLogin(restoreSession) {
    jQuery.ajax({
        data: "UserIdentifier=" + $("#Username").val() + "&restoreSession=" + restoreSession,
        url: "Helpers/userLogin.aspx",
        type: "POST",
        datatype: 'html',
        cache: false,
        error: function () {
            alert("UserLogin: A problem has occurred. Please contact the Clerk's Office @ 937-496-7623");
        },
        success: function () {
            window.location.reload();
        }
    });
}

function userLogoff() {
    jQuery.ajax({
        url: "Helpers/userLogoff.aspx",
        type: "POST",
        datatype: 'html',
        cache: false,
        error: function () {
            alert("UserLogout: A problem has occurred. Please contact the Clerk's Office @ 937-496-7623");
        },
        success: function () {
            window.location.reload();
        }
    });
}

function buildSearchCriteria() {
    jQuery.ajax({
        url: "Helpers/buildSearchCriteria.aspx",
        type: "POST",
        datatype: 'html',
        cache: false,
        error: function () {
            alert("A problem has occurred. Please contact the I.T. Help Desk.");
        },
        success: function (r) {
            $("#SearchCriteria").html(r);
            $("#gen_case_number").focus();
            $("#gen_case_number").keypress(function (e) {
                if (e.which == 13) {
                    openTab('genSearch', $('#frmGenSearch').serialize());
                }
            });
        }
    });
}

function openDisclaimer() {
    var myModal = new bootstrap.Modal(document.getElementById('DisclaimerModal'), { backdrop: 'static', keyboard: false });
    myModal.show();
}

function acceptDisclaimer() {
    disclaimer = "true"; // DISCLAIMER HAS BEEN ACCEPTED SO SET THE JAVASCRIPT VARIABLE TO TRUE
    jQuery.ajax({
        data: "disclaimer=" + disclaimer,
        url: "Helpers/acceptDisclaimer.aspx",
        type: "POST",
        datatype: 'html',
        cache: false,
        error: function (f) {
            alert("A problem has occurred. Please contact the I.T. Help Desk.");
        },
        success: function (r) {
            var myModal = bootstrap.Modal.getInstance(document.getElementById('DisclaimerModal'));
            myModal.hide();
        }
    });
}

function setActiveTab(xyz) {
    $("#Home").scrollTop(1); // ALWAYS SET THE HOME SCREEN TO THE TOP OF THE SCREEN
    if (xyz == "navCase") {
        $("#lblCaseTitle").removeClass("d-none");
    }
    else {
        $("#lblCaseTitle").addClass("navbar-text d-none");
    }
    jQuery.ajax({
        data: "tab=" + xyz,
        url: "Helpers/setActiveTab.aspx",
        type: "POST",
        datatype: 'html',
        cache: false,
        error: function () {
            alert("A problem has occurred. Please contact the I.T. Help Desk.");
        }
    });
}

function openTab(xyz, formData, display = 1, caseDisplay = "") {
    loadingOn();
    if (getParameterByName("SID") != null)
        formData += "&SID=" + getParameterByName("SID");
    if (xyz == "judgeSearch") {
        jQuery.ajax({
            data: formData,
            url: "Helpers/judgesCalendar.aspx",
            type: "POST",
            datatype: 'html',
            cache: false,
            error: function (f) {
                alert("A problem has occurred. Please contact the I.T. Help Desk.");
            },
            success: function (r) {
                $("#JudgesCalendar").html(r);
                $("#navJudgeCal").removeClass("d-none");
                if (display == 1) {
                    $('.nav-tabs a[href="#JudgesCalendar"]').tab('show');
                    setActiveTab("navJudgeCal");
                    $("#JudgesCalendar").scrollTop(0);
                }
            },
            complete: function () {
                loadingOff();
            }
        });
        
    }
    else if (xyz == "Admin") {
        jQuery.ajax({
            data: formData,
            url: "Helpers/adminSettings.aspx",
            type: "POST",
            datatype: 'html',
            cache: false,
            error: function (f) {
                alert("A problem has occurred. Please contact the I.T. Help Desk.");
            },
            success: function (r) {
                $("#Admin").html(r);
                $("#navAdmin").removeClass("d-none");
                if (display == 1) {
                    $('.nav-tabs a[href="#Admin"]').tab('show');
                    setActiveTab("navAdmin");
                    $("#Admin").scrollTop(0);
                }
            },
            complete: function () {
                loadingOff();
            }
        });
    }
    else if (xyz == "genSearch") {
        jQuery.ajax({
            url: "Helpers/authenticateSearch.aspx",
            type: "POST",
            datatype: 'html',
            cache: false,
            async: false,
            error: function (f) {
                alert("A problem has occurred. Please contact the I.T. Help Desk.");
            },
            success: function (r) {
                if (r == "False") {
                    grecaptcha.ready(function () {
                        grecaptcha.execute('6LcIVYQcAAAAAB3UDYAT2rh-EelDlT7i48-tTvhv', { action: 'genSearch' }).then(function (token) {
                            formData += "&captchaToken=" + token;

                            jQuery.ajax({
                                data: formData,
                                url: "Helpers/generalSearchResults.aspx",
                                type: "POST",
                                datatype: 'html',
                                cache: false,
                                error: function (f) {
                                    alert("A problem has occurred. Please contact the I.T. Help Desk.");
                                },
                                success: function (r) {
                                    $("#Results").html(r);
                                    $("#navResults").removeClass("d-none");
                                    if (display == 1) {
                                        $('.nav-tabs a[href="#Results"]').tab('show');
                                        setActiveTab("navResults");
                                        $("#Results").scrollTop(0);
                                    }
                                },
                                complete: function () {
                                    loadingOff();
                                }
                            });
                        });
                    });
                } else {
                    formData += "&captchaToken=";
                    jQuery.ajax({
                        data: formData,
                        url: "Helpers/generalSearchResults.aspx",
                        type: "POST",
                        datatype: 'html',
                        cache: false,
                        error: function (f) {
                            alert("A problem has occurred. Please contact the I.T. Help Desk.");
                        },
                        success: function (r) {
                            $("#Results").html(r);
                            $("#navResults").removeClass("d-none");
                            if (display == 1) {
                                $('.nav-tabs a[href="#Results"]').tab('show');
                                setActiveTab("navResults");
                                $("#Results").scrollTop(0);
                            }
                        },
                        complete: function () {
                            loadingOff();
                        }
                    });
                }
            }
        });
    }
    else if (xyz == "attSearch") {
        jQuery.ajax({
            url: "Helpers/authenticateSearch.aspx",
            type: "POST",
            datatype: 'html',
            cache: false,
            async: false,
            error: function (f) {
                alert("A problem has occurred. Please contact the I.T. Help Desk.");
            },
            success: function (r) {
                if (r == "False") {
                    grecaptcha.ready(function () {
                        grecaptcha.execute('6LcIVYQcAAAAAB3UDYAT2rh-EelDlT7i48-tTvhv', { action: 'attSearch' }).then(function (token) {
                            formData += "&captchaToken=" + token;

                            jQuery.ajax({
                                data: formData,
                                url: "Helpers/attorneySearchResults.aspx",
                                type: "POST",
                                datatype: 'html',
                                cache: false,
                                error: function (f) {
                                    alert("A problem has occurred. Please contact the I.T. Help Desk.");
                                },
                                success: function (r) {
                                    $("#Results").html(r);
                                    $("#navResults").removeClass("d-none");
                                    if (display == 1) {
                                        $('.nav-tabs a[href="#Results"]').tab('show');
                                        setActiveTab("navResults");
                                        $("#Results").scrollTop(0);
                                    }
                                },
                                complete: function () {
                                    loadingOff();
                                }
                            });
                        });
                    });
                } else {
                    formData += "&captchaToken=";
                    jQuery.ajax({
                        data: formData,
                        url: "Helpers/attorneySearchResults.aspx",
                        type: "POST",
                        datatype: 'html',
                        cache: false,
                        error: function (f) {
                            alert("A problem has occurred. Please contact the I.T. Help Desk.");
                        },
                        success: function (r) {
                            $("#Results").html(r);
                            $("#navResults").removeClass("d-none");
                            if (display == 1) {
                                $('.nav-tabs a[href="#Results"]').tab('show');
                                setActiveTab("navResults");
                                $("#Results").scrollTop(0);
                            }
                        },
                        complete: function () {
                            loadingOff();
                        }
                    });
                }
            }
        });
    }
    else if (xyz == "attyDetail") {
        jQuery.ajax({
            data: formData,
            url: "Helpers/attorneySearchDetails.aspx",
            type: "POST",
            datatype: 'html',
            cache: false,
            error: function (f) {
                alert("A problem has occurred. Please contact the I.T. Help Desk.");
            },
            success: function (r) {
                $("#AttorneyDetail").html(r);
                $("#navAttyDetail").removeClass("d-none");
                if (display == 1) {
                    $('.nav-tabs a[href="#AttorneyDetail"]').tab('show');
                    setActiveTab("navAttyDetail");
                    $("#AttorneyDetail").scrollTop(0);
                }
            },
            complete: function () {
                loadingOff();
            }
        });   
    }
    else if (xyz == "caseInfo" || xyz == "caseInfoJ") {
        var temp = formData.split('&');
        var case_id = temp[0].split('=');
        $.ajax({
            data: formData,
            url: "Helpers/caseInformation.aspx",
            type: "POST",
            datatype: 'html',
            cache: false,
            error: function () {
                alert("A problem has occurred. Please contact the I.T. Help Desk.");
                //window.location.reload();
            },
            success: function (r) {
                if (temp[1] == "screen=docket") {
                    $("#Case").html("<div class=\"row\"><div class=\"col-lg-12 col-xl-6 pr-xl-0 please-scroll\">" + r + "</div><div class=\"col-xl-6 pl-xl-0 d-lg-none d-xl-block\"><iframe id=\"docketImageViewer\" title=\"Docket Image Viewer\" class=\"sticky-top m-0\" src=\"Helpers/getDocumentFromOnBase.aspx?docketid=0&documenttype=docket\" style=\"width:100%; border:1px solid #dee2e6;\"></iframe></div></div>");
                }
                else if (temp[1] == "screen=cpcgd") {
                    $("#Case").html("<div class=\"row\"><div class=\"col-lg-12 col-xl-6 pr-xl-0 please-scroll\">" + r + "</div><div class=\"col-xl-6 pl-xl-0 d-lg-none d-xl-block\"><iframe id=\"docketImageViewer\" title=\"Docket Image Viewer\" class=\"sticky-top m-0\" src=\"Helpers/getDocumentFromOnBase.aspx?docketid=0&documenttype=cpcgd\" style=\"width:100%; border:1px solid #dee2e6;\"></iframe></div></div>");
                }
                else {
                    $("#Case").html(r);
                }
                $("#navCase").removeClass("d-none");
                $("#lblCaseInfo").html(caseDisplay);
                if (xyz == "caseInfoJ") {
                    $(".judgeCalendarRows").each(function () {
                        $(this).css("background-color", "#FAFAFA");
                    });
                    $("#judgeRow_" + case_id[1]).css("background-color", "#FFFFE0");
                }
                
                if (display == 1) {
                    $('.nav-tabs a[href="#Case"]').tab('show');
                    setActiveTab("navCase");
                    $("#Case").scrollTop(0);
                }
            },
            complete: function () {
                $("#lblCaseTitle").html($("#active_case_title").val());
                $("iframe").css("height", window.innerHeight - 115 + "px");
                loadingOff();
            }
        });
    }
}

function resizeTabs() {
    var myHeight = window.innerHeight;
    $(".myTabContent").css("height", myHeight - 110 + "px");
    $("iframe").css("height", myHeight - 115 + "px");
}

function createBinder() {
    if ($("#caseInfo_modalStartDate").val() != "") {
        var a = new Date($("#caseInfo_modalStartDate").val());

        if (!isValidDate(a)) {
            alert("Start Date: Not a valid date.");
            $("#caseInfo_modalStartDate").focus();
            return false;
        }
    }

    if ($("#caseInfo_modalEndDate").val() != "") {
        var b = new Date($("#caseInfo_modalEndDate").val());

        if (!isValidDate(b)) {
            alert("End Date: Not a valid date.");
            $("#caseInfo_modalEndDate").focus();
            return false;
        }
    }

    loadingOn("Creating Binder...");
    window.open("/Helpers/createCaseBinder.aspx?filename=" + $("#lblCaseInfo").html() + "&" + $("#frmCreateCaseBinder").serialize());
    loadingOff();
}

function retrieveDocketImage(docketid, documenttype) {
    jQuery.ajax({
        data: "docketid=" + docketid + "&documenttype=" + documenttype,
        url: "Helpers/getDocumentFromOnbase.aspx",
        type: "POST",
        datatype: 'html',
        cache: false,
        error: function () {
            alert("A problem has occurred. Please contact the Clerk's Office @ 937-496-7623");
        },
        success: function (r) {
            alert(r);
        }
    });
}

function viewDocketImage(docketid, screen) {
    $("#docketImageViewer").attr("src", "Helpers/getDocumentFromOnBase.aspx?docketid=" + docketid + "&documenttype=" + screen + "&option=viewer");
    
    if (screen == "docket") {
        $(".docketRows").each(function () {
            $(this).css("background-color", "initial");
        });
        $("#docket_row_" + docketid).css("background-color", "#FFFFE0");
    }
    else if (screen == "cpcgd") {
        $(".cpcgdRows").each(function () {
            $(this).css("background-color", "initial");
        });
        $("#cpcgd_row_" + docketid).css("background-color", "#FFFFE0");
    }
}

function notificationSignUp() {
    if ($("#notFirstName").val() == "") {
        alert("First Name: Please enter a First Name for the Subscriber.");
        $("#notFirstName").focus();
        return false;
    }
    if ($("#notLastName").val() == "") {
        alert("Last Name: Please enter a Last Name for the Subscriber.");
        $("#notLastName").focus();
        return false;
    }

    if (!$("#notMethodEmail").is(":checked") && !$("#notMethodSMS").is(":checked")) {
        alert("How would you like to receive notifications:\r\nAt least Email or Texts must be selected");
        return false;
    }

    if ($("#notMethodEmail").is(":checked") && $("#notEmail").val() == "") {
        alert("Email: Please enter an Email address for the Subscriber.");
        $("#notEmail").focus();
        return false;
    }

    if ($("#notMethodEmail").is(":checked") && !validateEmail($("#notEmail").val())) {
        alert("Email: Please enter a valid Email address.");
        $("#notEmail").focus();
        return false;
    }

    if ($("#notMethodSMS").is(":checked") && $("#notSMS").val() == "") {
        alert("Phone Number: Please enter a Phone Number for the Subscriber.");
        $("#notSMS").focus();
        return false;
    }

    if ($("#notMethodSMS").is(":checked") && !validatePhone($("#notSMS").val())) {
        alert("Phone Number: Please enter a valid Phone Number.");
        $("#notSMS").focus();
        return false;
    }

    //alert($("#frmNotificationSignUp").serialize() + "&case_id=" + $('#active_case_id').val());

    jQuery.ajax({
        data: $("#frmNotificationSignUp").serialize() + "&case_id=" + $('#active_case_id').val(),
        url: "Helpers/signupNotifications.aspx",
        type: "POST",
        datatype: 'html',
        cache: false,
        error: function () {
            alert("A problem has occurred. Please contact the Clerk's Office @ 937-496-7623");
        },
        success: function (r) {
            alert(r);
            var myModal = bootstrap.Modal.getInstance(document.getElementById('caseNotification_Modal'));
            myModal.hide();
        }
    });
}

function sendEmail() {
    if ($("#EMTo").val() == "") {
        alert("To: Please enter an email address to send to.");
        $("#EMTo").focus();
        return false;
    }

    if (!validateEmail($("#EMTo").val())) {
        alert("To: Please enter a valid email address.");
        $("#EMTo").focus();
        return false;
    }

    jQuery.ajax({
        data: "to=" + $("#EMTo").val() + "&from=" + $("#EMFrom").html() + "&comments=" + $("#EMComments").val() + "&action=" + $("#EMAction").val() + "&id=" + $("#EMID").html(),
        url: "Helpers/sendEmail.aspx",
        type: "POST",
        datatype: 'html',
        cache: false,
        error: function () {
            alert("A problem has occurred. Please contact the Clerk's Office @ 937-496-7623");
        },
        success: function (r) {
            alert(r);
            var myModal = bootstrap.Modal.getInstance(document.getElementById('EmailModal'));
            myModal.hide();
        }
    });
}

function getParameterByName(name, url = window.location.href) {
    name = name.replace(/[\[\]]/g, '\\$&');
    var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, ' '));
}

function loadingOn(xyz) {
    if (xyz == undefined)
        xyz = "Loading...";

    $("#LoadingText").html(xyz);
    var myModal = bootstrap.Modal.getOrCreateInstance(document.getElementById('LoadingModal'), { backdrop: 'static', keyboard: false });
    myModal.show();
    //$("#LoadingModal").modal({ backdrop: 'static', keyboard: false });   
}

function loadingOff() {
    var myModal = bootstrap.Modal.getInstance(document.getElementById('LoadingModal'));
    myModal.hide();
    //$("#LoadingModal").modal("hide");
}

function isValidDate(d) {
    return d instanceof Date && !isNaN(d);
}

function sortTable(tableName, rowSeed, n, isNumber = 0) {
    var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
    table = document.getElementById(tableName).parentElement;
    switching = true;
    dir = "asc";
    while (switching) {
        switching = false;
        rows = table.rows;
        for (i = rowSeed; i < (rows.length - 1); i++) {
            shouldSwitch = false;

            x = rows[i].getElementsByTagName("TD")[n];
            y = rows[i + 1].getElementsByTagName("TD")[n];

            if (dir == "asc") {
                if (isNumber == 0) {
                    if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                        shouldSwitch = true;
                        break;
                    }
                }
                else {
                    if (Number(x.innerHTML) > Number(y.innerHTML)) {
                        shouldSwitch = true;
                        break;
                    }
                }
            } else if (dir == "desc") {
                if (isNumber == 0) {
                    if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                        shouldSwitch = true;
                        break;
                    }
                } else {
                    if (Number(x.innerHTML) < Number(y.innerHTML)) {
                        shouldSwitch = true;
                        break;
                    }
                }
            }
        }

        if (shouldSwitch) {
            rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
            switching = true;
            switchcount++;
        } else {
            if (switchcount == 0 && dir == "asc") {
                dir = "desc";
                switching = true;
            }
        }
    }
}

const validateEmail = (email) => {
    return email.match(
        /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
    );
};

const validatePhone = (phonenumber) => {
    return phonenumber.match(
        /^\(?(\d{3})\)?[- ]?(\d{3})[- ]?(\d{4})$/
    );
};